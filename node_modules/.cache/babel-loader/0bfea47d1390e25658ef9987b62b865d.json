{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Kaustubh Sinha\\\\Desktop\\\\bookkart\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _objectSpread from\"C:\\\\Users\\\\Kaustubh Sinha\\\\Desktop\\\\bookkart\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"C:\\\\Users\\\\Kaustubh Sinha\\\\Desktop\\\\bookkart\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\Kaustubh Sinha\\\\Desktop\\\\bookkart\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import{API,graphqlOperation}from\"aws-amplify\";import{v4 as uuidv4}from\"uuid\";import{listBooks}from\"../api/queries\";import{processOrder}from\"../api/mutations\";var BookContext=React.createContext();var BookProvider=function BookProvider(_ref){var children=_ref.children;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),books=_useState2[0],setBooks=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),featured=_useState4[0],setFeatured=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];useEffect(function(){fetchBooks();},[]);var checkout=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(orderDetails){var payload;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:payload=_objectSpread({id:uuidv4()},orderDetails);_context.prev=1;_context.next=4;return API.graphql(graphqlOperation(processOrder,{input:payload}));case 4:console.log(\"Order is successful\");_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](1);console.log(_context.t0);case 10:case\"end\":return _context.stop();}}},_callee,null,[[1,7]]);}));return function checkout(_x){return _ref2.apply(this,arguments);};}();var fetchBooks=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$API$graphql,data,_books,_featured;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;setLoading(true);// Switch authMode to API_KEY for public access\n_context2.next=4;return API.graphql({query:listBooks,authMode:\"API_KEY\"});case 4:_yield$API$graphql=_context2.sent;data=_yield$API$graphql.data;_books=data.listBooks.items;_featured=_books.filter(function(book){return!!book.featured;});setBooks(_books);setFeatured(_featured);setLoading(false);_context2.next=16;break;case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 16:case\"end\":return _context2.stop();}}},_callee2,null,[[0,13]]);}));return function fetchBooks(){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(BookContext.Provider,{value:{books:books,featured:featured,loading:loading,checkout:checkout}},children);};export{BookContext,BookProvider};","map":{"version":3,"sources":["C:/Users/Kaustubh Sinha/Desktop/bookkart/src/context/books.js"],"names":["React","useEffect","useState","API","graphqlOperation","v4","uuidv4","listBooks","processOrder","BookContext","createContext","BookProvider","children","books","setBooks","featured","setFeatured","loading","setLoading","fetchBooks","checkout","orderDetails","payload","id","graphql","input","console","log","query","authMode","data","items","filter","book"],"mappings":"4pBAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,GAAT,CAAcC,gBAAd,KAAsC,aAAtC,CACA,OAASC,EAAE,GAAIC,CAAAA,MAAf,KAA6B,MAA7B,CACA,OAASC,SAAT,KAA0B,gBAA1B,CACA,OAASC,YAAT,KAA6B,kBAA7B,CAEA,GAAMC,CAAAA,WAAW,CAAGT,KAAK,CAACU,aAAN,EAApB,CAEA,GAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,MAAkB,IAAfC,CAAAA,QAAe,MAAfA,QAAe,eACXV,QAAQ,CAAC,EAAD,CADG,wCAC9BW,KAD8B,eACvBC,QADuB,8BAELZ,QAAQ,CAAC,EAAD,CAFH,yCAE9Ba,QAF8B,eAEpBC,WAFoB,8BAGPd,QAAQ,CAAC,KAAD,CAHD,yCAG9Be,OAH8B,eAGrBC,UAHqB,eAKrCjB,SAAS,CAAC,UAAM,CACdkB,UAAU,GACX,CAFQ,CAEN,EAFM,CAAT,CAIA,GAAMC,CAAAA,QAAQ,2FAAG,iBAAOC,YAAP,8HACTC,OADS,gBAEbC,EAAE,CAAEjB,MAAM,EAFG,EAGVe,YAHU,wCAMPlB,CAAAA,GAAG,CAACqB,OAAJ,CAAYpB,gBAAgB,CAACI,YAAD,CAAe,CAAEiB,KAAK,CAAEH,OAAT,CAAf,CAA5B,CANO,QAObI,OAAO,CAACC,GAAR,CAAY,qBAAZ,EAPa,+EASbD,OAAO,CAACC,GAAR,cATa,oEAAH,kBAARP,CAAAA,QAAQ,6CAAd,CAaA,GAAMD,CAAAA,UAAU,2FAAG,sMAEfD,UAAU,CAAC,IAAD,CAAV,CACA;AAHe,uBAIQf,CAAAA,GAAG,CAACqB,OAAJ,CAAY,CACjCI,KAAK,CAAErB,SAD0B,CAEjCsB,QAAQ,CAAE,SAFuB,CAAZ,CAJR,0CAIPC,IAJO,oBAIPA,IAJO,CAQTjB,MARS,CAQDiB,IAAI,CAACvB,SAAL,CAAewB,KARd,CASThB,SATS,CASEF,MAAK,CAACmB,MAAN,CAAa,SAACC,IAAD,CAAU,CACtC,MAAO,CAAC,CAACA,IAAI,CAAClB,QAAd,CACD,CAFgB,CATF,CAYfD,QAAQ,CAACD,MAAD,CAAR,CACAG,WAAW,CAACD,SAAD,CAAX,CACAG,UAAU,CAAC,KAAD,CAAV,CAde,qFAgBfQ,OAAO,CAACC,GAAR,eAhBe,uEAAH,kBAAVR,CAAAA,UAAU,2CAAhB,CAoBA,mBACE,oBAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAE,CAAEN,KAAK,CAALA,KAAF,CAASE,QAAQ,CAARA,QAAT,CAAmBE,OAAO,CAAPA,OAAnB,CAA4BG,QAAQ,CAARA,QAA5B,CAA7B,EACGR,QADH,CADF,CAKD,CA/CD,CAiDA,OAASH,WAAT,CAAsBE,YAAtB","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { API, graphqlOperation } from \"aws-amplify\";\r\nimport { v4 as uuidv4 } from \"uuid\";\r\nimport { listBooks } from \"../api/queries\";\r\nimport { processOrder } from \"../api/mutations\";\r\n\r\nconst BookContext = React.createContext();\r\n\r\nconst BookProvider = ({ children }) => {\r\n  const [books, setBooks] = useState([]);\r\n  const [featured, setFeatured] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchBooks();\r\n  }, []);\r\n\r\n  const checkout = async (orderDetails) => {\r\n    const payload = {\r\n      id: uuidv4(),\r\n      ...orderDetails\r\n    };\r\n    try {\r\n      await API.graphql(graphqlOperation(processOrder, { input: payload }));\r\n      console.log(\"Order is successful\");\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  const fetchBooks = async () => {\r\n    try {\r\n      setLoading(true);\r\n      // Switch authMode to API_KEY for public access\r\n      const { data } = await API.graphql({\r\n        query: listBooks,\r\n        authMode: \"API_KEY\"\r\n      });\r\n      const books = data.listBooks.items;\r\n      const featured = books.filter((book) => {\r\n        return !!book.featured;\r\n      });\r\n      setBooks(books);\r\n      setFeatured(featured);\r\n      setLoading(false);\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <BookContext.Provider value={{ books, featured, loading, checkout }}>\r\n      {children}\r\n    </BookContext.Provider>\r\n  );\r\n};\r\n\r\nexport { BookContext, BookProvider };\r\n"]},"metadata":{},"sourceType":"module"}