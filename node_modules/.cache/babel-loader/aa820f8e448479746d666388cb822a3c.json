{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.supportsZeroByteGCM = exports.supportsSubtleCrypto = exports.supportsSecureRandom = exports.supportsWebCrypto = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar subtleCryptoMethods = [\"decrypt\", \"digest\", \"encrypt\", \"exportKey\", \"generateKey\", \"importKey\", \"sign\", \"verify\"];\n\nfunction supportsWebCrypto(window) {\n  if (supportsSecureRandom(window) && typeof window.crypto.subtle === \"object\") {\n    var subtle = window.crypto.subtle;\n    return supportsSubtleCrypto(subtle);\n  }\n\n  return false;\n}\n\nexports.supportsWebCrypto = supportsWebCrypto;\n\nfunction supportsSecureRandom(window) {\n  if (typeof window === \"object\" && typeof window.crypto === \"object\") {\n    var getRandomValues = window.crypto.getRandomValues;\n    return typeof getRandomValues === \"function\";\n  }\n\n  return false;\n}\n\nexports.supportsSecureRandom = supportsSecureRandom;\n\nfunction supportsSubtleCrypto(subtle) {\n  return subtle && subtleCryptoMethods.every(function (methodName) {\n    return typeof subtle[methodName] === \"function\";\n  });\n}\n\nexports.supportsSubtleCrypto = supportsSubtleCrypto;\n\nfunction supportsZeroByteGCM(subtle) {\n  return tslib_1.__awaiter(this, void 0, void 0, function () {\n    var key, zeroByteAuthTag, _a;\n\n    return tslib_1.__generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          if (!supportsSubtleCrypto(subtle)) return [2\n          /*return*/\n          , false];\n          _b.label = 1;\n\n        case 1:\n          _b.trys.push([1, 4,, 5]);\n\n          return [4\n          /*yield*/\n          , subtle.generateKey({\n            name: \"AES-GCM\",\n            length: 128\n          }, false, [\"encrypt\"])];\n\n        case 2:\n          key = _b.sent();\n          return [4\n          /*yield*/\n          , subtle.encrypt({\n            name: \"AES-GCM\",\n            iv: new Uint8Array(Array(12)),\n            additionalData: new Uint8Array(Array(16)),\n            tagLength: 128\n          }, key, new Uint8Array(0))];\n\n        case 3:\n          zeroByteAuthTag = _b.sent();\n          return [2\n          /*return*/\n          , zeroByteAuthTag.byteLength === 16];\n\n        case 4:\n          _a = _b.sent();\n          return [2\n          /*return*/\n          , false];\n\n        case 5:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nexports.supportsZeroByteGCM = supportsZeroByteGCM;","map":{"version":3,"sources":["../src/supportsWebCrypto.ts"],"names":[],"mappings":";;;;;;;;;AAUA,IAAM,mBAAmB,GAA8B,CACrD,SADqD,EAErD,QAFqD,EAGrD,SAHqD,EAIrD,WAJqD,EAKrD,aALqD,EAMrD,WANqD,EAOrD,MAPqD,EAQrD,QARqD,CAAvD;;AAWA,SAAgB,iBAAhB,CAAkC,MAAlC,EAAgD;AAC9C,MACE,oBAAoB,CAAC,MAAD,CAApB,IACA,OAAO,MAAM,CAAC,MAAP,CAAc,MAArB,KAAgC,QAFlC,EAGE;AACQ,QAAA,MAAM,GAAK,MAAM,CAAC,MAAP,CAAL,MAAN;AAER,WAAO,oBAAoB,CAAC,MAAD,CAA3B;AACD;;AAED,SAAO,KAAP;AACD;;AAXD,OAAA,CAAA,iBAAA,GAAA,iBAAA;;AAaA,SAAgB,oBAAhB,CAAqC,MAArC,EAAmD;AACjD,MAAI,OAAO,MAAP,KAAkB,QAAlB,IAA8B,OAAO,MAAM,CAAC,MAAd,KAAyB,QAA3D,EAAqE;AAC3D,QAAA,eAAe,GAAK,MAAM,CAAC,MAAP,CAAL,eAAf;AAER,WAAO,OAAO,eAAP,KAA2B,UAAlC;AACD;;AAED,SAAO,KAAP;AACD;;AARD,OAAA,CAAA,oBAAA,GAAA,oBAAA;;AAUA,SAAgB,oBAAhB,CAAqC,MAArC,EAAyD;AACvD,SACE,MAAM,IACN,mBAAmB,CAAC,KAApB,CACE,UAAA,UAAA,EAAU;AAAI,WAAA,OAAO,MAAM,CAAC,UAAD,CAAb,KAAA,UAAA;AAAwC,GADxD,CAFF;AAMD;;AAPD,OAAA,CAAA,oBAAA,GAAA,oBAAA;;AASA,SAAsB,mBAAtB,CAA0C,MAA1C,EAA8D;;;;;;;AAC5D,cAAI,CAAC,oBAAoB,CAAC,MAAD,CAAzB,EAAmC,OAAA,CAAA;AAAA;AAAA,YAAO,KAAP,CAAA;;;;;;AAErB,iBAAA,CAAA;AAAA;AAAA,YAAM,MAAM,CAAC,WAAP,CAChB;AAAE,YAAA,IAAI,EAAE,SAAR;AAAmB,YAAA,MAAM,EAAE;AAA3B,WADgB,EAEhB,KAFgB,EAGhB,CAAC,SAAD,CAHgB,CAAN,CAAA;;;AAAN,UAAA,GAAG,GAAG,EAAA,CAAA,IAAA,EAAN;AAKkB,iBAAA,CAAA;AAAA;AAAA,YAAM,MAAM,CAAC,OAAP,CAC5B;AACE,YAAA,IAAI,EAAE,SADR;AAEE,YAAA,EAAE,EAAE,IAAI,UAAJ,CAAe,KAAK,CAAC,EAAD,CAApB,CAFN;AAGE,YAAA,cAAc,EAAE,IAAI,UAAJ,CAAe,KAAK,CAAC,EAAD,CAApB,CAHlB;AAIE,YAAA,SAAS,EAAE;AAJb,WAD4B,EAO5B,GAP4B,EAQ5B,IAAI,UAAJ,CAAe,CAAf,CAR4B,CAAN,CAAA;;;AAAlB,UAAA,eAAe,GAAG,EAAA,CAAA,IAAA,EAAlB;AAUN,iBAAA,CAAA;AAAA;AAAA,YAAO,eAAe,CAAC,UAAhB,KAA+B,EAAtC,CAAA;;;;AAEA,iBAAA,CAAA;AAAA;AAAA,YAAO,KAAP,CAAA;;;;;;;;;AAEH;;AAtBD,OAAA,CAAA,mBAAA,GAAA,mBAAA","sourcesContent":["type SubtleCryptoMethod =\n  | \"decrypt\"\n  | \"digest\"\n  | \"encrypt\"\n  | \"exportKey\"\n  | \"generateKey\"\n  | \"importKey\"\n  | \"sign\"\n  | \"verify\";\n\nconst subtleCryptoMethods: Array<SubtleCryptoMethod> = [\n  \"decrypt\",\n  \"digest\",\n  \"encrypt\",\n  \"exportKey\",\n  \"generateKey\",\n  \"importKey\",\n  \"sign\",\n  \"verify\"\n];\n\nexport function supportsWebCrypto(window: Window): boolean {\n  if (\n    supportsSecureRandom(window) &&\n    typeof window.crypto.subtle === \"object\"\n  ) {\n    const { subtle } = window.crypto;\n\n    return supportsSubtleCrypto(subtle);\n  }\n\n  return false;\n}\n\nexport function supportsSecureRandom(window: Window): boolean {\n  if (typeof window === \"object\" && typeof window.crypto === \"object\") {\n    const { getRandomValues } = window.crypto;\n\n    return typeof getRandomValues === \"function\";\n  }\n\n  return false;\n}\n\nexport function supportsSubtleCrypto(subtle: SubtleCrypto) {\n  return (\n    subtle &&\n    subtleCryptoMethods.every(\n      methodName => typeof subtle[methodName] === \"function\"\n    )\n  );\n}\n\nexport async function supportsZeroByteGCM(subtle: SubtleCrypto) {\n  if (!supportsSubtleCrypto(subtle)) return false;\n  try {\n    const key = await subtle.generateKey(\n      { name: \"AES-GCM\", length: 128 },\n      false,\n      [\"encrypt\"]\n    );\n    const zeroByteAuthTag = await subtle.encrypt(\n      {\n        name: \"AES-GCM\",\n        iv: new Uint8Array(Array(12)),\n        additionalData: new Uint8Array(Array(16)),\n        tagLength: 128\n      },\n      key,\n      new Uint8Array(0)\n    );\n    return zeroByteAuthTag.byteLength === 16;\n  } catch {\n    return false;\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}