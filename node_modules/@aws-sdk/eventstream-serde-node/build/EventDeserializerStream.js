"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const stream_1 = require("stream");
class EventDeserializerStream extends stream_1.Transform {
    constructor(options) {
        super(Object.assign({ readableObjectMode: true, writableObjectMode: true }, options));
        this.deserializer = options.deserializer;
        //TODO: use 'autoDestroy' when targeting Node 11
        //reference: https://nodejs.org/dist/latest-v13.x/docs/api/stream.html#stream_new_stream_readable_options
        this.on("error", () => {
            this.destroy();
        });
        this.on("end", () => {
            this.destroy();
        });
    }
    async _transform(chunk, encoding, callback) {
        try {
            this.push(await this.deserializer(chunk));
            return callback();
        }
        catch (err) {
            callback(err);
        }
    }
}
exports.EventDeserializerStream = EventDeserializerStream;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXZlbnREZXNlcmlhbGl6ZXJTdHJlYW0uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvRXZlbnREZXNlcmlhbGl6ZXJTdHJlYW0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxtQ0FBd0U7QUFNeEUsTUFBYSx1QkFBd0IsU0FBUSxrQkFBUztJQUVwRCxZQUFZLE9BQXVDO1FBQ2pELEtBQUssaUJBQ0gsa0JBQWtCLEVBQUUsSUFBSSxFQUN4QixrQkFBa0IsRUFBRSxJQUFJLElBQ3JCLE9BQU8sRUFDVixDQUFDO1FBQ0gsSUFBSSxDQUFDLFlBQVksR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDO1FBQ3pDLGdEQUFnRDtRQUNoRCx5R0FBeUc7UUFDekcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFO1lBQ3BCLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNqQixDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRTtZQUNsQixJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDakIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsS0FBSyxDQUFDLFVBQVUsQ0FBQyxLQUFVLEVBQUUsUUFBZ0IsRUFBRSxRQUEyQjtRQUN4RSxJQUFJO1lBQ0YsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUMxQyxPQUFPLFFBQVEsRUFBRSxDQUFDO1NBQ25CO1FBQUMsT0FBTyxHQUFHLEVBQUU7WUFDWixRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDZjtJQUNILENBQUM7Q0FDRjtBQTNCRCwwREEyQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUcmFuc2Zvcm0sIFRyYW5zZm9ybU9wdGlvbnMsIFRyYW5zZm9ybUNhbGxiYWNrIH0gZnJvbSBcInN0cmVhbVwiO1xuXG5leHBvcnQgdHlwZSBFdmVudERlc2VyaWFsaXplclN0cmVhbU9wdGlvbnMgPSBUcmFuc2Zvcm1PcHRpb25zICYge1xuICBkZXNlcmlhbGl6ZXI6IChpbnB1dDogYW55KSA9PiBhbnk7XG59O1xuXG5leHBvcnQgY2xhc3MgRXZlbnREZXNlcmlhbGl6ZXJTdHJlYW0gZXh0ZW5kcyBUcmFuc2Zvcm0ge1xuICBwcml2YXRlIHJlYWRvbmx5IGRlc2VyaWFsaXplcjogKGlucHV0OiBhbnkpID0+IGFueTtcbiAgY29uc3RydWN0b3Iob3B0aW9uczogRXZlbnREZXNlcmlhbGl6ZXJTdHJlYW1PcHRpb25zKSB7XG4gICAgc3VwZXIoe1xuICAgICAgcmVhZGFibGVPYmplY3RNb2RlOiB0cnVlLFxuICAgICAgd3JpdGFibGVPYmplY3RNb2RlOiB0cnVlLFxuICAgICAgLi4ub3B0aW9uc1xuICAgIH0pO1xuICAgIHRoaXMuZGVzZXJpYWxpemVyID0gb3B0aW9ucy5kZXNlcmlhbGl6ZXI7XG4gICAgLy9UT0RPOiB1c2UgJ2F1dG9EZXN0cm95JyB3aGVuIHRhcmdldGluZyBOb2RlIDExXG4gICAgLy9yZWZlcmVuY2U6IGh0dHBzOi8vbm9kZWpzLm9yZy9kaXN0L2xhdGVzdC12MTMueC9kb2NzL2FwaS9zdHJlYW0uaHRtbCNzdHJlYW1fbmV3X3N0cmVhbV9yZWFkYWJsZV9vcHRpb25zXG4gICAgdGhpcy5vbihcImVycm9yXCIsICgpID0+IHtcbiAgICAgIHRoaXMuZGVzdHJveSgpO1xuICAgIH0pO1xuICAgIHRoaXMub24oXCJlbmRcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5kZXN0cm95KCk7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBfdHJhbnNmb3JtKGNodW5rOiBhbnksIGVuY29kaW5nOiBzdHJpbmcsIGNhbGxiYWNrOiBUcmFuc2Zvcm1DYWxsYmFjaykge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLnB1c2goYXdhaXQgdGhpcy5kZXNlcmlhbGl6ZXIoY2h1bmspKTtcbiAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==