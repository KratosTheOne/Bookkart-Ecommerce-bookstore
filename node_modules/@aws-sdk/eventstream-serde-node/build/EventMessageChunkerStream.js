"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const stream_1 = require("stream");
class EventMessageChunkerStream extends stream_1.Transform {
    constructor(options = {}) {
        super(Object.assign({ readableObjectMode: true }, options));
        this.currentMessageTotalLength = 0;
        this.currentMessagePendingLength = 0;
        this.currentMessage = null;
        this.messageLengthBuffer = null;
        //TODO: use 'autoDestroy' when targeting Node 11
        //reference: https://nodejs.org/dist/latest-v13.x/docs/api/stream.html#stream_new_stream_readable_options
        this.on("error", () => {
            this.destroy();
        });
        this.on("end", () => {
            this.destroy();
        });
    }
    _transform(chunk, encoding, callback) {
        const chunkLength = chunk.length;
        let currentOffset = 0;
        while (currentOffset < chunkLength) {
            // create new message if necessary
            if (!this.currentMessage) {
                // working on a new message, determine total length
                const bytesRemaining = chunkLength - currentOffset;
                // prevent edge case where total length spans 2 chunks
                if (!this.messageLengthBuffer) {
                    this.messageLengthBuffer = Buffer.alloc(4);
                }
                const numBytesForTotal = Math.min(4 - this.currentMessagePendingLength, // remaining bytes to fill the messageLengthBuffer
                bytesRemaining // bytes left in chunk
                );
                chunk.copy(this.messageLengthBuffer, this.currentMessagePendingLength, currentOffset, currentOffset + numBytesForTotal);
                this.currentMessagePendingLength += numBytesForTotal;
                currentOffset += numBytesForTotal;
                if (this.currentMessagePendingLength < 4) {
                    // not enough information to create the current message
                    break;
                }
                this.allocateMessage(this.messageLengthBuffer.readUInt32BE(0));
                this.messageLengthBuffer = null;
            }
            // write data into current message
            const numBytesToWrite = Math.min(this.currentMessageTotalLength - this.currentMessagePendingLength, // number of bytes left to complete message
            chunkLength - currentOffset // number of bytes left in the original chunk
            );
            chunk.copy(this.currentMessage, // target buffer
            this.currentMessagePendingLength, // target offset
            currentOffset, // chunk offset
            currentOffset + numBytesToWrite // chunk end to write
            );
            this.currentMessagePendingLength += numBytesToWrite;
            currentOffset += numBytesToWrite;
            // check if a message is ready to be pushed
            if (this.currentMessageTotalLength &&
                this.currentMessageTotalLength === this.currentMessagePendingLength) {
                // push out the message
                this.push(this.currentMessage);
                // cleanup
                this.currentMessage = null;
                this.currentMessageTotalLength = 0;
                this.currentMessagePendingLength = 0;
            }
        }
        callback();
    }
    _flush(callback) {
        if (this.currentMessageTotalLength) {
            if (this.currentMessageTotalLength === this.currentMessagePendingLength) {
                callback(undefined, this.currentMessage);
            }
            else {
                callback(new Error("Truncated event message received."));
            }
        }
        else {
            callback();
        }
    }
    allocateMessage(size) {
        if (typeof size !== "number") {
            throw new Error("Attempted to allocate an event message where size was not a number: " +
                size);
        }
        this.currentMessageTotalLength = size;
        this.currentMessagePendingLength = 4;
        this.currentMessage = Buffer.alloc(size);
        this.currentMessage.writeUInt32BE(size, 0);
    }
}
exports.EventMessageChunkerStream = EventMessageChunkerStream;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXZlbnRNZXNzYWdlQ2h1bmtlclN0cmVhbS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9FdmVudE1lc3NhZ2VDaHVua2VyU3RyZWFtLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsbUNBQXdFO0FBRXhFLE1BQWEseUJBQTBCLFNBQVEsa0JBQVM7SUFNdEQsWUFBWSxVQUE0QixFQUFFO1FBQ3hDLEtBQUssaUJBQ0gsa0JBQWtCLEVBQUUsSUFBSSxJQUNyQixPQUFPLEVBQ1YsQ0FBQztRQUNILElBQUksQ0FBQyx5QkFBeUIsR0FBRyxDQUFDLENBQUM7UUFDbkMsSUFBSSxDQUFDLDJCQUEyQixHQUFHLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztRQUMzQixJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDO1FBQ2hDLGdEQUFnRDtRQUNoRCx5R0FBeUc7UUFDekcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFO1lBQ3BCLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNqQixDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRTtZQUNsQixJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDakIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsVUFBVSxDQUFDLEtBQVUsRUFBRSxRQUFnQixFQUFFLFFBQTJCO1FBQ2xFLE1BQU0sV0FBVyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFDakMsSUFBSSxhQUFhLEdBQUcsQ0FBQyxDQUFDO1FBRXRCLE9BQU8sYUFBYSxHQUFHLFdBQVcsRUFBRTtZQUNsQyxrQ0FBa0M7WUFDbEMsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUU7Z0JBQ3hCLG1EQUFtRDtnQkFDbkQsTUFBTSxjQUFjLEdBQUcsV0FBVyxHQUFHLGFBQWEsQ0FBQztnQkFDbkQsc0RB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QUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6QyxJQUFJLENBQUMsY0FBZSxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDOUMsQ0FBQztDQUNGO0FBcEhELDhEQW9IQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRyYW5zZm9ybSwgVHJhbnNmb3JtT3B0aW9ucywgVHJhbnNmb3JtQ2FsbGJhY2sgfSBmcm9tIFwic3RyZWFtXCI7XG5cbmV4cG9ydCBjbGFzcyBFdmVudE1lc3NhZ2VDaHVua2VyU3RyZWFtIGV4dGVuZHMgVHJhbnNmb3JtIHtcbiAgcHJpdmF0ZSBjdXJyZW50TWVzc2FnZVRvdGFsTGVuZ3RoOiBudW1iZXI7XG4gIHByaXZhdGUgY3VycmVudE1lc3NhZ2VQZW5kaW5nTGVuZ3RoOiBudW1iZXI7XG4gIHByaXZhdGUgY3VycmVudE1lc3NhZ2U6IEJ1ZmZlciB8IG51bGw7XG4gIHByaXZhdGUgbWVzc2FnZUxlbmd0aEJ1ZmZlcjogQnVmZmVyIHwgbnVsbDtcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBUcmFuc2Zvcm1PcHRpb25zID0ge30pIHtcbiAgICBzdXBlcih7XG4gICAgICByZWFkYWJsZU9iamVjdE1vZGU6IHRydWUsXG4gICAgICAuLi5vcHRpb25zXG4gICAgfSk7XG4gICAgdGhpcy5jdXJyZW50TWVzc2FnZVRvdGFsTGVuZ3RoID0gMDtcbiAgICB0aGlzLmN1cnJlbnRNZXNzYWdlUGVuZGluZ0xlbmd0aCA9IDA7XG4gICAgdGhpcy5jdXJyZW50TWVzc2FnZSA9IG51bGw7XG4gICAgdGhpcy5tZXNzYWdlTGVuZ3RoQnVmZmVyID0gbnVsbDtcbiAgICAvL1RPRE86IHVzZSAnYXV0b0Rlc3Ryb3knIHdoZW4gdGFyZ2V0aW5nIE5vZGUgMTFcbiAgICAvL3JlZmVyZW5jZTogaHR0cHM6Ly9ub2RlanMub3JnL2Rpc3QvbGF0ZXN0LXYxMy54L2RvY3MvYXBpL3N0cmVhbS5odG1sI3N0cmVhbV9uZXdfc3RyZWFtX3JlYWRhYmxlX29wdGlvbnNcbiAgICB0aGlzLm9uKFwiZXJyb3JcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5kZXN0cm95KCk7XG4gICAgfSk7XG4gICAgdGhpcy5vbihcImVuZFwiLCAoKSA9PiB7XG4gICAgICB0aGlzLmRlc3Ryb3koKTtcbiAgICB9KTtcbiAgfVxuXG4gIF90cmFuc2Zvcm0oY2h1bms6IGFueSwgZW5jb2Rpbmc6IHN0cmluZywgY2FsbGJhY2s6IFRyYW5zZm9ybUNhbGxiYWNrKTogdm9pZCB7XG4gICAgY29uc3QgY2h1bmtMZW5ndGggPSBjaHVuay5sZW5ndGg7XG4gICAgbGV0IGN1cnJlbnRPZmZzZXQgPSAwO1xuXG4gICAgd2hpbGUgKGN1cnJlbnRPZmZzZXQgPCBjaHVua0xlbmd0aCkge1xuICAgICAgLy8gY3JlYXRlIG5ldyBtZXNzYWdlIGlmIG5lY2Vzc2FyeVxuICAgICAgaWYgKCF0aGlzLmN1cnJlbnRNZXNzYWdlKSB7XG4gICAgICAgIC8vIHdvcmtpbmcgb24gYSBuZXcgbWVzc2FnZSwgZGV0ZXJtaW5lIHRvdGFsIGxlbmd0aFxuICAgICAgICBjb25zdCBieXRlc1JlbWFpbmluZyA9IGNodW5rTGVuZ3RoIC0gY3VycmVudE9mZnNldDtcbiAgICAgICAgLy8gcHJldmVudCBlZGdlIGNhc2Ugd2hlcmUgdG90YWwgbGVuZ3RoIHNwYW5zIDIgY2h1bmtzXG4gICAgICAgIGlmICghdGhpcy5tZXNzYWdlTGVuZ3RoQnVmZmVyKSB7XG4gICAgICAgICAgdGhpcy5tZXNzYWdlTGVuZ3RoQnVmZmVyID0gQnVmZmVyLmFsbG9jKDQpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG51bUJ5dGVzRm9yVG90YWwgPSBNYXRoLm1pbihcbiAgICAgICAgICA0IC0gdGhpcy5jdXJyZW50TWVzc2FnZVBlbmRpbmdMZW5ndGgsIC8vIHJlbWFpbmluZyBieXRlcyB0byBmaWxsIHRoZSBtZXNzYWdlTGVuZ3RoQnVmZmVyXG4gICAgICAgICAgYnl0ZXNSZW1haW5pbmcgLy8gYnl0ZXMgbGVmdCBpbiBjaHVua1xuICAgICAgICApO1xuXG4gICAgICAgIGNodW5rLmNvcHkoXG4gICAgICAgICAgdGhpcy5tZXNzYWdlTGVuZ3RoQnVmZmVyLFxuICAgICAgICAgIHRoaXMuY3VycmVudE1lc3NhZ2VQZW5kaW5nTGVuZ3RoLFxuICAgICAgICAgIGN1cnJlbnRPZmZzZXQsXG4gICAgICAgICAgY3VycmVudE9mZnNldCArIG51bUJ5dGVzRm9yVG90YWxcbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLmN1cnJlbnRNZXNzYWdlUGVuZGluZ0xlbmd0aCArPSBudW1CeXRlc0ZvclRvdGFsO1xuICAgICAgICBjdXJyZW50T2Zmc2V0ICs9IG51bUJ5dGVzRm9yVG90YWw7XG5cbiAgICAgICAgaWYgKHRoaXMuY3VycmVudE1lc3NhZ2VQZW5kaW5nTGVuZ3RoIDwgNCkge1xuICAgICAgICAgIC8vIG5vdCBlbm91Z2ggaW5mb3JtYXRpb24gdG8gY3JlYXRlIHRoZSBjdXJyZW50IG1lc3NhZ2VcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFsbG9jYXRlTWVzc2FnZSh0aGlzLm1lc3NhZ2VMZW5ndGhCdWZmZXIucmVhZFVJbnQzMkJFKDApKTtcbiAgICAgICAgdGhpcy5tZXNzYWdlTGVuZ3RoQnVmZmVyID0gbnVsbDtcbiAgICAgIH1cblxuICAgICAgLy8gd3JpdGUgZGF0YSBpbnRvIGN1cnJlbnQgbWVzc2FnZVxuICAgICAgY29uc3QgbnVtQnl0ZXNUb1dyaXRlID0gTWF0aC5taW4oXG4gICAgICAgIHRoaXMuY3VycmVudE1lc3NhZ2VUb3RhbExlbmd0aCAtIHRoaXMuY3VycmVudE1lc3NhZ2VQZW5kaW5nTGVuZ3RoLCAvLyBudW1iZXIgb2YgYnl0ZXMgbGVmdCB0byBjb21wbGV0ZSBtZXNzYWdlXG4gICAgICAgIGNodW5rTGVuZ3RoIC0gY3VycmVudE9mZnNldCAvLyBudW1iZXIgb2YgYnl0ZXMgbGVmdCBpbiB0aGUgb3JpZ2luYWwgY2h1bmtcbiAgICAgICk7XG4gICAgICBjaHVuay5jb3B5KFxuICAgICAgICB0aGlzLmN1cnJlbnRNZXNzYWdlLCAvLyB0YXJnZXQgYnVmZmVyXG4gICAgICAgIHRoaXMuY3VycmVudE1lc3NhZ2VQZW5kaW5nTGVuZ3RoLCAvLyB0YXJnZXQgb2Zmc2V0XG4gICAgICAgIGN1cnJlbnRPZmZzZXQsIC8vIGNodW5rIG9mZnNldFxuICAgICAgICBjdXJyZW50T2Zmc2V0ICsgbnVtQnl0ZXNUb1dyaXRlIC8vIGNodW5rIGVuZCB0byB3cml0ZVxuICAgICAgKTtcbiAgICAgIHRoaXMuY3VycmVudE1lc3NhZ2VQZW5kaW5nTGVuZ3RoICs9IG51bUJ5dGVzVG9Xcml0ZTtcbiAgICAgIGN1cnJlbnRPZmZzZXQgKz0gbnVtQnl0ZXNUb1dyaXRlO1xuXG4gICAgICAvLyBjaGVjayBpZiBhIG1lc3NhZ2UgaXMgcmVhZHkgdG8gYmUgcHVzaGVkXG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMuY3VycmVudE1lc3NhZ2VUb3RhbExlbmd0aCAmJlxuICAgICAgICB0aGlzLmN1cnJlbnRNZXNzYWdlVG90YWxMZW5ndGggPT09IHRoaXMuY3VycmVudE1lc3NhZ2VQZW5kaW5nTGVuZ3RoXG4gICAgICApIHtcbiAgICAgICAgLy8gcHVzaCBvdXQgdGhlIG1lc3NhZ2VcbiAgICAgICAgdGhpcy5wdXNoKHRoaXMuY3VycmVudE1lc3NhZ2UpO1xuICAgICAgICAvLyBjbGVhbnVwXG4gICAgICAgIHRoaXMuY3VycmVudE1lc3NhZ2UgPSBudWxsO1xuICAgICAgICB0aGlzLmN1cnJlbnRNZXNzYWdlVG90YWxMZW5ndGggPSAwO1xuICAgICAgICB0aGlzLmN1cnJlbnRNZXNzYWdlUGVuZGluZ0xlbmd0aCA9IDA7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY2FsbGJhY2soKTtcbiAgfVxuXG4gIF9mbHVzaChjYWxsYmFjazogVHJhbnNmb3JtQ2FsbGJhY2spOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jdXJyZW50TWVzc2FnZVRvdGFsTGVuZ3RoKSB7XG4gICAgICBpZiAodGhpcy5jdXJyZW50TWVzc2FnZVRvdGFsTGVuZ3RoID09PSB0aGlzLmN1cnJlbnRNZXNzYWdlUGVuZGluZ0xlbmd0aCkge1xuICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHRoaXMuY3VycmVudE1lc3NhZ2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKFwiVHJ1bmNhdGVkIGV2ZW50IG1lc3NhZ2UgcmVjZWl2ZWQuXCIpKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFsbG9jYXRlTWVzc2FnZShzaXplOiBudW1iZXIpIHtcbiAgICBpZiAodHlwZW9mIHNpemUgIT09IFwibnVtYmVyXCIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgXCJBdHRlbXB0ZWQgdG8gYWxsb2NhdGUgYW4gZXZlbnQgbWVzc2FnZSB3aGVyZSBzaXplIHdhcyBub3QgYSBudW1iZXI6IFwiICtcbiAgICAgICAgICBzaXplXG4gICAgICApO1xuICAgIH1cbiAgICB0aGlzLmN1cnJlbnRNZXNzYWdlVG90YWxMZW5ndGggPSBzaXplO1xuICAgIHRoaXMuY3VycmVudE1lc3NhZ2VQZW5kaW5nTGVuZ3RoID0gNDtcbiAgICB0aGlzLmN1cnJlbnRNZXNzYWdlID0gQnVmZmVyLmFsbG9jKHNpemUpO1xuICAgIHRoaXMuY3VycmVudE1lc3NhZ2UhLndyaXRlVUludDMyQkUoc2l6ZSwgMCk7XG4gIH1cbn1cbiJdfQ==