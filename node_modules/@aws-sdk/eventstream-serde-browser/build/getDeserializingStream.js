"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
function getDeserializingStream(messageStream, deserializer) {
    var messageReader = messageStream.getReader();
    var deserializedStream = new ReadableStream({
        start: function (controller) {
            function push() {
                var _this = this;
                messageReader.read().then(function (_a) {
                    var done = _a.done, value = _a.value;
                    return tslib_1.__awaiter(_this, void 0, void 0, function () {
                        var _b, _c, e_1;
                        return tslib_1.__generator(this, function (_d) {
                            switch (_d.label) {
                                case 0:
                                    if (done) {
                                        controller.close();
                                        return [2 /*return*/];
                                    }
                                    _d.label = 1;
                                case 1:
                                    _d.trys.push([1, 3, , 4]);
                                    _c = (_b = controller).enqueue;
                                    return [4 /*yield*/, deserializer(value)];
                                case 2:
                                    _c.apply(_b, [_d.sent()]);
                                    push();
                                    return [3 /*break*/, 4];
                                case 3:
                                    e_1 = _d.sent();
                                    controller.error(e_1);
                                    return [3 /*break*/, 4];
                                case 4: return [2 /*return*/];
                            }
                        });
                    });
                });
            }
            push();
        }
    });
    return deserializedStream;
}
exports.getDeserializingStream = getDeserializingStream;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0RGVzZXJpYWxpemluZ1N0cmVhbS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9nZXREZXNlcmlhbGl6aW5nU3RyZWFtLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUVBLFNBQWdCLHNCQUFzQixDQUNwQyxhQUEwRCxFQUMxRCxZQUFpQztJQUVqQyxJQUFNLGFBQWEsR0FBRyxhQUFhLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDaEQsSUFBTSxrQkFBa0IsR0FBRyxJQUFJLGNBQWMsQ0FBMEI7UUFDckUsS0FBSyxZQUFDLFVBQVU7WUFDZCxTQUFTLElBQUk7Z0JBQWIsaUJBY0M7Z0JBYkMsYUFBYSxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFPLEVBQWU7d0JBQWIsY0FBSSxFQUFFLGdCQUFLOzs7Ozs7b0NBQzVDLElBQUksSUFBSSxFQUFFO3dDQUNSLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQzt3Q0FDbkIsc0JBQU87cUNBQ1I7Ozs7b0NBR0MsS0FBQSxDQUFBLEtBQUEsVUFBVSxDQUFBLENBQUMsT0FBTyxDQUFBO29DQUFDLHFCQUFNLFlBQVksQ0FBQyxLQUFLLENBQUMsRUFBQTs7b0NBQTVDLGNBQW1CLFNBQXlCLEVBQUMsQ0FBQztvQ0FDOUMsSUFBSSxFQUFFLENBQUM7Ozs7b0NBRVAsVUFBVSxDQUFDLEtBQUssQ0FBQyxHQUFDLENBQUMsQ0FBQzs7Ozs7O2lCQUV2QixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsSUFBSSxFQUFFLENBQUM7UUFDVCxDQUFDO0tBQ0YsQ0FBQyxDQUFDO0lBQ0gsT0FBTyxrQkFBa0IsQ0FBQztBQUM1QixDQUFDO0FBM0JELHdEQTJCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1lc3NhZ2UgfSBmcm9tIFwiQGF3cy1zZGsvdHlwZXNcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldERlc2VyaWFsaXppbmdTdHJlYW0oXG4gIG1lc3NhZ2VTdHJlYW06IFJlYWRhYmxlU3RyZWFtPHsgW25hbWU6IHN0cmluZ106IE1lc3NhZ2UgfT4sXG4gIGRlc2VyaWFsaXplcjogKGlucHV0OiBhbnkpID0+IGFueVxuKTogUmVhZGFibGVTdHJlYW08eyBbbmFtZTogc3RyaW5nXTogYW55IH0+IHtcbiAgY29uc3QgbWVzc2FnZVJlYWRlciA9IG1lc3NhZ2VTdHJlYW0uZ2V0UmVhZGVyKCk7XG4gIGNvbnN0IGRlc2VyaWFsaXplZFN0cmVhbSA9IG5ldyBSZWFkYWJsZVN0cmVhbTx7IFtuYW1lOiBzdHJpbmddOiBhbnkgfT4oe1xuICAgIHN0YXJ0KGNvbnRyb2xsZXIpIHtcbiAgICAgIGZ1bmN0aW9uIHB1c2goKSB7XG4gICAgICAgIG1lc3NhZ2VSZWFkZXIucmVhZCgpLnRoZW4oYXN5bmMgKHsgZG9uZSwgdmFsdWUgfSkgPT4ge1xuICAgICAgICAgIGlmIChkb25lKSB7XG4gICAgICAgICAgICBjb250cm9sbGVyLmNsb3NlKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZShhd2FpdCBkZXNlcmlhbGl6ZXIodmFsdWUpKTtcbiAgICAgICAgICAgIHB1c2goKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb250cm9sbGVyLmVycm9yKGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHB1c2goKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gZGVzZXJpYWxpemVkU3RyZWFtO1xufVxuIl19